import { writeFile } from "fs/promises";
import { getCsv } from "../../../utils/points";

type VulnerabilityIntegralCsvRow = {
  y: number;
  dy: number;
  xrisksumUp: number;
  xrisksumDown: number;
  dyRiskUp: number;
  dyRiskDown: number;
};
const header: (keyof VulnerabilityIntegralCsvRow)[] = [
  "y",
  "dy",
  "xrisksumUp",
  "xrisksumDown",
  "dyRiskUp",
  "dyRiskDown",
];
export const writeAreaVulnerabilityIntegralCsv = async (
  results: {
    rows: {
      y: number;
      dy: number;
      xrisksumUp: number;
      xrisksumDown: number;
      dyRiskUp: number;
      dyRiskDown: number;
    }[];
    totalRiskUp: number;
    totalRiskDown: number;
  },
  filename: string
) => {
  const table: (string | number)[][] = results.rows.map((it) =>
    header.map((key) => it[key] || "")
  );
  table.unshift([...header, "totalRiskUp", "totalRiskDown"]);
  table.push([
    ...Array(header.length).fill(""),
    results.totalRiskUp,
    results.totalRiskDown,
  ]);
  await writeFile(filename, await getCsv(table));
};
